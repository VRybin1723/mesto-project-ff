(()=>{"use strict";function e(e){setTimeout((function(){e.classList.add("popup_is-opened")}),10),document.addEventListener("keydown",t),e.classList.add("popup_is-animated")}function t(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}var n=document.querySelector(".profile__title"),r=document.querySelector(".profile__description"),c=document.querySelector(".profile__image");function u(t,n,r,c,u,a){var i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),p=i.querySelector("img"),l=i.querySelector("h2"),s=i.querySelector(".card__delete-button"),f=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count"),_=document.querySelector(".popup_type_delete"),m=_.querySelector(".popup__form");return p.src=t.link,p.alt=t.name,l.textContent=t.name,d.textContent=t.likes?t.likes.length:0,u===t.owner._id?s.style.display="block":s.style.display="none",s.addEventListener("click",(function(){e(_),m.onsubmit=function(e){var r,c;e.preventDefault(),(r=t._id,c="https://nomoreparties.co/v1/wff-cohort-14/cards/".concat(r),fetch(c,{method:"DELETE",headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574"}}).then((function(e){if(e.ok)return e.json()}))).then((function(){n(i),o(_)})).catch((function(e){console.error(e),o(_)}))}})),f.addEventListener("click",(function(){var e=f.classList.contains("card__like-button_is-active");r(f,t._id,e,d)})),p.addEventListener("click",(function(){c(p)})),i}function a(e){e.remove()}var i=function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),o.classList.remove("popup__input-error_active"),o.textContent=""},p=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_inactive")):(t.disabled=!0,t.classList.add("popup__button_inactive"))},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=Array.from(e.querySelectorAll(".popup__input"));o.forEach((function(o){i(e,o),t&&(o.value="")}));var n=e.querySelector(".popup__button");p(o,n)};function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var f=document.querySelector(".places__list"),d=(document.querySelector(".popup"),document.querySelector(".popup_type_edit")),_=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),S=d.querySelector(".popup__input_type_name"),q=d.querySelector(".popup__input_type_description"),g=m.querySelector(".popup__image"),k=m.querySelector(".popup__caption"),E=document.querySelector(".popup__form"),L=E.querySelector(".popup__input");function w(e,t,o,n){var r=o?"DELETE":"PUT",c="https://nomoreparties.co/v1/wff-cohort-14/cards/likes/".concat(t);fetch(c,{method:r,headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574"}}).then((function(e){if(!e.ok)throw new Error("Сетевая ошибка: "+e.status);return e.json()})).then((function(t){var r=t.likes.length;e.classList.toggle("card__like-button_is-active",!o),n.textContent=r}))}E.querySelector(".".concat(L.id,"-error")),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&o(e),t.target.classList.contains("popup__close")&&o(e)}))})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){e(d),function(e,t,o,n,r){n.value=t.textContent,r.value=o.textContent,l(e.querySelector(".popup__form"))}(d,v,h,S,q)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){e(_),l(_.querySelector(".popup__form"),!0)}));var C=document.querySelector(".popup_type_avatar");b.addEventListener("click",(function(){e(C),l(C.querySelector(".popup__form"),!0)})),d.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var t,n,r=S.value,c=q.value;A(e.target,!0,"Сохранение..."),(t=r,n=c,fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me",{method:"PATCH",headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574","Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v.textContent=e.name,h.textContent=e.about,o(d)})).catch((function(e){console.log("Ошибка при обновлении профиля:",e)}))}));var j=document.forms["new-place"];function A(e,t,o){var n=e.querySelector(".popup__button");n.textContent=o,n.disabled=t}j.addEventListener("submit",(function(e){e.preventDefault();var t=j.elements["place-name"].value,n=j.elements.link.value;A(e.target,!0,"Сохранение..."),function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-14/cards",{method:"POST",headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n).then((function(e){!function(e,t,o,n){var r=u(e,a,w,void 0,void 0);f.prepend(r)}(e),o(_),j.reset()})).catch((function(e){console.log("Ошибка при добавлении новой карточки:",e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");p(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),n.textContent=o,n.classList.add("popup__input-error_active")}(e,t,t.validationMessage)}(e,n),p(t,o)}))}))}(e)})),Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me",{headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574"}}).then((function(e){return e.json()})).then((function(e){return n.textContent=e.name,r.textContent=e.about,c.style.backgroundImage="url(".concat(e.avatar,")"),e._id})).catch((function(e){console.error("Ошибка. Запрос на получение данных пользователя не выполнен:",e)})),fetch("https://nomoreparties.co/v1/wff-cohort-14/cards",{headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574"}}).then((function(e){if(!e.ok)throw new Error("Ошибка HTTP: ".concat(e.status));return e.json()})).catch((function(e){console.error("Ошибка. Запрос на получение карточек не выполнен:",e)}))]).then((function(t){var o,n,r=(n=2,function(e){if(Array.isArray(e))return e}(o=t)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c,u,a=[],i=!0,p=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){p=!0,r=e}finally{try{if(!i&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(p)throw r}}return a}}(o,n)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?s(e,t):void 0}}(o,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],i=r[1];i.map((function(e){return e.owner._id})),function(t,o,n){t.forEach((function(t){f.append(u(t,a,w,(function(t){e(m),function(e,t,o,n){o.src=t.src,o.alt=t.alt,n.textContent=t.alt}(0,t,g,k)}),o,t.owner._id))}))}(i,c)})).catch((function(e){console.error("Ошибка при выполнении Promise.all:",e)})),y.addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("link-input").value.trim();A(e.target,!0,"Сохранение..."),function(e){fetch("https://nomoreparties.co/v1/wff-cohort-14/users/me/avatar",{method:"PATCH",headers:{authorization:"8026ba24-3947-401b-ab48-c209fe9bf574","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.json()})).then((function(e){c.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)}))}(t)}))})();